
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Cloning Dijit Widgets - Developer's Corner</title>
  <meta name="author" content="Antonio Bello">

  
  <meta name="description" content="Cloning Dijit widgets">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.developer-corner.com/2011/06/cloning-dijit-widgets">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Developer's Corner" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-112847-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Developer's Corner</a></h1>
  
    <h2>by Antonio Bello</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.developer-corner.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Cloning Dijit Widgets</h1>
    
    
      <p class="meta">
        








  



  
<time datetime="2011-06-06T09:41:00+02:00" pubdate data-updated="true">Jun 6<span>th</span>, 2011</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://www.developer-corner.com">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Dojox and Dijit widgets are undoubtedly cool, bringing a richer user
experience to your web site.</p>

<p>One of their drawback though is that they are not easily cloneable. A typical
example is for instance a table with a set of controls per row and a “Add new
row” button, allowing to add a new row to the table.</p>

<p>This article provides a simple solution to clone a table row containing dijit
widgets.</p>

<!-- more -->


<h1>The problem</h1>

<p>I&rsquo;ve recently started using dojo and dijit to provide some cool user interface
experience on a project I am working on.</p>

<p>During implementation I&rsquo;ve faced with a problem: I have a table with a set of
widgets on each row, initially with a single row, but with the user able to
add as many rows as he needs. Unfortunately <em>there is no (native) way to clone
a dijit widget</em>, so I had to find a different solution.</p>

<p>I am using the declarative approach of creating dijit widgets, by adding some
dijit related attributes to input controls and let the dojo parser convert
them from normal input controls to dijit widgets. For instance, the following
input textbox:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&#39;text&#39;</span> <span class="na">dojoType=</span><span class="s">&#39;dijit.form.ValidationTextBox&#39;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>is parsed by dojo and converted into a ValidationTextBox widget like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;div</span>
</span><span class='line'>    <span class="na">class=</span><span class="s">&quot;dijit dijitReset dijitInlineTable dijitLeft dijitTextBox dijitValidationTextBox&quot;</span>
</span><span class='line'>    <span class="na">id=</span><span class="s">&quot;widget_dijit_form_ValidationTextBox_0&quot;</span> <span class="na">role=</span><span class="s">&quot;presentation&quot;</span>
</span><span class='line'>    <span class="na">dir=</span><span class="s">&quot;ltr&quot;</span> <span class="na">widgetid=</span><span class="s">&quot;dijit_form_ValidationTextBox_0&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;dijitReset dijitValidationContainer&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span>
</span><span class='line'>            <span class="na">class=</span><span class="s">&quot;dijitReset dijitInputField dijitValidationIcon dijitValidationInner&quot;</span>
</span><span class='line'>            <span class="na">value=</span><span class="s">&quot;Χ&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">tabindex=</span><span class="s">&quot;-1&quot;</span> <span class="na">readonly=</span><span class="s">&quot;readonly&quot;</span>
</span><span class='line'>            <span class="na">role=</span><span class="s">&quot;presentation&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;dijitReset dijitInputField dijitInputContainer&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">&quot;dijitReset dijitInputInner&quot;</span>
</span><span class='line'>            <span class="na">dojoattachpoint=</span><span class="s">&quot;textbox,focusNode&quot;</span> <span class="na">autocomplete=</span><span class="s">&quot;off&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span>
</span><span class='line'>            <span class="na">id=</span><span class="s">&quot;dijit_form_ValidationTextBox_0&quot;</span> <span class="na">tabindex=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Conversion from html control to dijit widget can be performed either
automatically, by specifying the <code>djconfig='parseOnLoad:true'</code> parameter when
loading the dojo script:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script</span>
</span><span class='line'><span class="nt"> </span><span class="na">type=</span><span class="s">&#39;text/javascript&#39;</span>
</span><span class='line'>  <span class="na">src=</span><span class="s">&#39;https://ajax.googleapis.com/ajax/libs/dojo/1.6.0/dojo/dojo.xd.js&#39;</span>
</span><span class='line'>  <span class="na">djconfig=</span><span class="s">&#39;parseOnLoad:true&#39;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>or manually, by calling the <code>dojo.parser.parse()</code> function, most likely in <code>addOnLoad()</code>.</p>

<h1>The solution</h1>

<p>The idea behind the solution I’ve found out can be summarized as follows:</p>

<ol>
<li> read the table row <strong>before</strong> conversion from input control to dijit widget occurs and save its html code in a safe place</li>
<li> reuse the table row as a template to clone new table rows, and apply the dojo parsing on it for input to widget conversions</li>
</ol>


<p>In order to work, row cloning must be done <em>before</em> the dojo parsing occurs.</p>

<p>This is the raw html form we’ll work on:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;form</span> <span class="na">dojoType=</span><span class="s">&#39;dijit.form.Form&#39;</span> <span class="na">id=</span><span class="s">&#39;form&#39;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&#39;hidden&#39;</span> <span class="na">value=</span><span class="s">&#39;1&#39;</span> <span class="na">id=</span><span class="s">&#39;hRowsCounter&#39;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&#39;button&#39;</span> <span class="na">id=</span><span class="s">&#39;btnAddNewRow&#39;</span> <span class="na">value=</span><span class="s">&#39;Add new row&#39;</span>  <span class="na">label=</span><span class="s">&#39;Add new row&#39;</span> <span class="na">dojoType=</span><span class="s">&#39;dijit.form.Button&#39;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">&#39;table&#39;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;thead&gt;</span>
</span><span class='line'>            <span class="nt">&lt;tr&gt;</span>
</span><span class='line'>                <span class="nt">&lt;td&gt;</span>Quantity<span class="nt">&lt;/td&gt;</span>
</span><span class='line'>                <span class="nt">&lt;td&gt;</span>Unit Price<span class="nt">&lt;/td&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/thead&gt;</span>
</span><span class='line'>        <span class="nt">&lt;tbody&gt;</span>
</span><span class='line'>            <span class="nt">&lt;tr</span> <span class="na">id=</span><span class="s">&quot;row-1&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">&#39;text&#39;</span>  <span class="na">id=</span><span class="s">&#39;editQuantity1&#39;</span> <span class="na">dojoType=</span><span class="s">&#39;dijit.form.NumberSpinner&#39;</span> <span class="na">required=</span><span class="s">&#39;true&#39;</span> <span class="nt">/&gt;&lt;/td&gt;</span>
</span><span class='line'>                <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">&#39;text&#39;</span>  <span class="na">id=</span><span class="s">&#39;editUnitPrice1&#39;</span> <span class="na">dojoType=</span><span class="s">&#39;dijit.form.CurrencyTextBox&#39;</span> <span class="na">required=</span><span class="s">&#39;true&#39;</span> <span class="nt">/&gt;&lt;/td&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/tr&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/tbody&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/table&gt;</span>
</span><span class='line'>    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&#39;submit&#39;</span> <span class="na">value=</span><span class="s">&#39;Submit&#39;</span> <span class="na">label=</span><span class="s">&#39;Submit&#39;</span> <span class="na">dojoType=</span><span class="s">&#39;dijit.form.Button&#39;</span>  <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/form&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The hidden field is used to keep track of the total number of rows, used both locally to generate the identifiers of the cloned controls and at server side, to let the web application know in advance how many rows to process.</p>

<p>The table row is made up of 2 dijit widgets, <code>NumberSpinner</code> and <code>CurrencyTextBox</code>,  but of course the same principle applies to any other dijit or dojox widget.</p>

<p>This form “as is” is rendered by the browser as a standard html form, not powered by dijit yet, and it should look like the following:</p>

<p><img src="/res/images/2011-06-06-cloning-dijit-widgets/standard_html_form.png" alt="Standard form" /></p>

<p>In order to perform the enhancement, we need some javascript code. First of all, we need to load the dojo library in the <code>&lt;head&gt;</code> section, along with jquery, which I’m going to use as I feel more familiar with:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;script</span>
</span><span class='line'>        <span class="na">type=</span><span class="s">&#39;text/javascript&#39;</span> <span class="na">src=</span><span class="s">&#39;https://ajax.googleapis.com/ajax/libs/dojo/1.6.0/dojo/dojo.xd.js&#39;</span>
</span><span class='line'>        <span class="na">djconfig=</span><span class="s">&#39;parseOnLoad:false&#39;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;script</span>
</span><span class='line'>        <span class="na">type=</span><span class="s">&#39;text/javascript&#39;</span>
</span><span class='line'>        <span class="na">src=</span><span class="s">&#39;http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js&#39;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice the <code>parseOnLoad</code> parameter explicitly set to false, to prevent automatic dojo parsing of the body, precondition needed for the solution to work. Following the javascript code to enhance the standard html form into a widget based dijit form.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s1">&#39;text/javascript&#39;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="nx">dojo</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;dijit.form.Form&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">dojo</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;dijit.form.Button&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">dojo</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;dijit.form.CurrencyTextBox&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">dojo</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;dijit.form.NumberSpinner&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">dojo</span><span class="p">.</span><span class="nx">addOnLoad</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Parse the body to convert input controls into dojox/dijit widgets</span>
</span><span class='line'>        <span class="nx">dojo</span><span class="p">.</span><span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">dojo</span><span class="p">.</span><span class="nx">body</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">dojo</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">dijit</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="s1">&#39;btnSubmit&#39;</span><span class="p">),</span> <span class="s1">&#39;onClick&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">dijit</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">).</span><span class="nx">submit</span><span class="p">();</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">dojo</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">dijit</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">),</span> <span class="s1">&#39;onSubmit&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">validate</span><span class="p">();</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>After adding the above code to our page, the form is now visibly different:</p>

<p><img src="/res/images/2011-06-06-cloning-dijit-widgets/enhanced_form.png" alt="Enhanced form" /></p>

<p>The final step is to implement the row addition. First we need to save the row template in the addOnLoad() event, prior to dojo parsing:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">rowTemplate</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">dojo</span><span class="p">.</span><span class="nx">addOnLoad</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Save the row template</span>
</span><span class='line'>    <span class="nx">rowTemplate</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#row-1&#39;</span><span class="p">).</span><span class="nx">clone</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Parse the body to convert input controls into dojox/dijit widgets</span>
</span><span class='line'>    <span class="nx">dojo</span><span class="p">.</span><span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">dojo</span><span class="p">.</span><span class="nx">body</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next we have to attach a click handler to the “Add new row” button:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">rowTemplate</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">dojo</span><span class="p">.</span><span class="nx">addOnLoad</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Save the row template</span>
</span><span class='line'>    <span class="nx">rowTemplate</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#row-1&#39;</span><span class="p">).</span><span class="nx">clone</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Parse the body to convert input controls into dojox/dijit widgets</span>
</span><span class='line'>    <span class="nx">dojo</span><span class="p">.</span><span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">dojo</span><span class="p">.</span><span class="nx">body</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">dojo</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">dijit</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="s1">&#39;btnSubmit&#39;</span><span class="p">),</span> <span class="s1">&#39;onClick&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">dijit</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">).</span><span class="nx">submit</span><span class="p">();</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">dojo</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">dijit</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">),</span> <span class="s1">&#39;onSubmit&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">validate</span><span class="p">();</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">dojo</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">dijit</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="s1">&#39;btnAddNewRow&#39;</span><span class="p">),</span> <span class="s1">&#39;onClick&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">addTableRow</span><span class="p">();</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Last, the missing piece is the actual addTableRow() implementation:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">addTableRow</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Retrieve the rows counter hidden control</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">hRowsCounter</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#hRowsCounter&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Calculate the next row index</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">hRowsCounter</span><span class="p">.</span><span class="nx">val</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Set the new row id</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">newRowId</span> <span class="o">=</span> <span class="s1">&#39;row-&#39;</span> <span class="o">+</span> <span class="nx">index</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Clone the table row from the previously saved template</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">newRow</span> <span class="o">=</span> <span class="nx">rowTemplate</span><span class="p">.</span><span class="nx">clone</span><span class="p">().</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">newRowId</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Replace the id of each input control</span>
</span><span class='line'>    <span class="nx">newRow</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">newId</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[\d]+$/g</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">newId</span><span class="p">)</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nx">newId</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}).</span><span class="nx">end</span><span class="p">().</span><span class="nx">appendTo</span><span class="p">(</span><span class="s1">&#39;#table&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Update the number of rows</span>
</span><span class='line'>    <span class="nx">hRowsCounter</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Force a dojo parsing of hte newly created row </span>
</span><span class='line'>    <span class="nx">dojo</span><span class="p">.</span><span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">dojo</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="nx">newRowId</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The actual row cloning is done at line 12, with contextual update of the row
id.</p>

<p>Lines 15 to 20 are used to locate all <code>&lt;input&gt;</code> controls in the newly created
row and for each one:</p>

<ul>
<li>calculate a unique control id (line 16)</li>
<li>reset the control value (line 17)</li>
<li>set the new control id (line 18)</li>
<li>set the control name (line 19)</li>
</ul>


<p>The new control id is calculated by replacing the ending numbers in the
control id with the row number, using a regular expression. If you look at the
html form code, you’ll see that each control in the table has an id made up of
a descriptive text (editQuantity) and a number, identifying the row. The
regular expression locates the ending number, so it can be replaced with the
new row number. Needless to say, this process is required to ensure that each
control in the table has a unique id.</p>

<p>Here is the final form, with some rows manually added to the table:</p>

<p><img src="/res/images/2011-06-06-cloning-dijit-widgets/enhanced_form_with_multiple_rows.png" alt="Enhanced form with multiple rows" /></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Antonio Bello</span></span>

      








  



  
<time datetime="2011-06-08T04:58:00+02:00" class="updated">Updated Jun 8<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/dijit/'>dijit</a>, <a class='category' href='/blog/categories/dojo/'>dojo</a>, <a class='category' href='/blog/categories/javascript/'>javascript</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://www.developer-corner.com/2011/06/cloning-dijit-widgets" data-via="ant_bello" data-counturl="http://www.developer-corner.com/2011/06/cloning-dijit-widgets" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2009/07/slow-build-on-compact-framework-projects" title="Previous Post: Slow build on compact framework projects">&laquo; Slow build on compact framework projects</a>
      
      
        <a class="basic-alignment right" href="/2014/04/time-tracking-app-in-meteor" title="Next Post: Creating a time tracking app with Meteor">Creating a time tracking app with Meteor &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2014/04/time-tracking-app-in-meteor">Creating a Time Tracking App With Meteor</a>
      </li>
    
      <li class="post">
        <a href="/2011/06/cloning-dijit-widgets">Cloning Dijit Widgets</a>
      </li>
    
      <li class="post">
        <a href="/2009/07/slow-build-on-compact-framework-projects">Slow Build on Compact Framework Projects</a>
      </li>
    
      <li class="post">
        <a href="/2009/06/casting-from-base-to-derived-class">Casting From Base to Derived Class</a>
      </li>
    
      <li class="post">
        <a href="/2009/02/choosing-web-color-scheme">Choosing a Web Color Scheme</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Antonio Bello -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'developer-corner';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.developer-corner.com/2011/06/cloning-dijit-widgets';
        var disqus_url = 'http://www.developer-corner.com/2011/06/cloning-dijit-widgets';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
